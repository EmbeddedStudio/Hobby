C51 COMPILER V9.56.0.0   MAIN                                                              05/18/2018 16:17:33 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\Output\main.obj
COMPILER INVOKED BY: D:\Program Files\AT89C51\C51\BIN\C51.EXE ..\User\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User) DE
                    -BUG OBJECTEXTEND PRINT(..\Listing\main.lst) TABS(8) OBJECT(..\Output\main.obj)

line level    source

   1          #include <reg52.h>
   2          
   3          #define u8  unsigned char
   4          #define u16 unsigned short
   5          #define u32 unsigned long
   6          //9E56  12M
   7          //4C00  22.1184M
   8          #define XTAL_12M  1
   9          u8 SegCode[10] = {0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F};  // 段选低电平有效
  10          sbit K1 = P3^2; 
  11          sbit K2 = P3^3; 
  12          sbit K3 = P3^0; 
  13          
  14          u8 Num1[4]={8,0,2,3};//改成自己的学号
  15          u8 Num2[4]={9,1,2,3};//改成自己的学号
  16          u8 Num3[4]={7,7,2,3};//改成自己的学号
  17          u8 start=0;  //开始显示的标志位
  18          u8  dir=0;   //定时器加还是减的标志方向 0 加方向 1 减方向
  19          char count=0;  //静态数码管显示的数值
  20          u8 key_flag=0;//显示学号的标志位
  21          u8 time =0;
  22          /* 函数的声明*/
  23          void delay( u16 t);
  24          
  25          
  26          void main()
  27          {
  28   1             
  29   1              u8 i=0;
  30   1              TMOD=0x01; //确定定时器方式
  31   1              
  32   1      //        #if XTAL_12M
  33   1                      TH0=0x9E;       //赋初值
  34   1                      TL0=0x56;  
  35   1      //        #else
  36   1      //                TH0=0x4C;       //赋初值
  37   1      //                TL0=0x00;
  38   1      //        #endif
  39   1              IE = 0x8F;
  40   1              P0=0x00;
  41   1              P2=0x00;
  42   1              while(1)
  43   1              {
  44   2                      if(K3==0)
  45   2                      {
  46   3                              delay(10);
  47   3                              if(K3==0)
  48   3                              {
  49   4                                      start=1;
  50   4                                      TR0=0;
  51   4                                      key_flag=2;
  52   4                                      count=0;
  53   4                              }
  54   3                      }
C51 COMPILER V9.56.0.0   MAIN                                                              05/18/2018 16:17:33 PAGE 2   

  55   2                      if(start!=0)
  56   2                      {
  57   3                              
  58   3                              P0=~SegCode[count];
  59   3                              for(i=0;i<4;i++)
  60   3                              {
  61   4                                      P1&=0xf8; //1111 1000
  62   4                                      P1|=i;   //xxxx x001
  63   4                                      if(key_flag ==0)
  64   4                                      {
  65   5                                              P2=SegCode[Num1[i]];
  66   5                                      }
  67   4                                      if (key_flag==1)
  68   4                                      {
  69   5                                              P2=SegCode[Num2[i]];
  70   5                                      }
  71   4                                      if(key_flag==2)
  72   4                                      {
  73   5                                              P2=SegCode[Num3[i]];
  74   5                                      }
  75   4                                      delay(1);
  76   4                                      P2=0x00;//消隐
  77   4                              }
  78   3                      }
  79   2              }
  80   1      }
  81          
  82          void delay( u16 t)
  83          {
  84   1              u16 i,j;
  85   1              for(i=0;i<t;i++)
  86   1                      for(j=0;j<1000;j++);
  87   1      }
  88          
  89          void INT0_IRQHander(void) interrupt 0
  90          {
  91   1             
  92   1              if(K1==0)
  93   1              {
  94   2                      delay(20);
  95   2                      if(K1==0)
  96   2                      {
  97   3                              TR0=1;
  98   3                              start=1;
  99   3                              key_flag=0;
 100   3                              dir=0;
 101   3                              time=0;
 102   3                      }
 103   2              }
 104   1      }
 105          void INT1_IRQHander(void) interrupt 2
 106          {
 107   1              if(K2==0)
 108   1              {
 109   2                      delay(20);
 110   2                      if(K2==0)
 111   2                      {
 112   3                              TR0=1;
 113   3                              start=1;
 114   3                              key_flag=1;
 115   3                              dir=1;
 116   3                              time=0;
C51 COMPILER V9.56.0.0   MAIN                                                              05/18/2018 16:17:33 PAGE 3   

 117   3                      }
 118   2              }
 119   1      }
 120          void TIM0_Handler() interrupt 1
 121          {
 122   1              
 123   1              TR0=0;
 124   1      //        #if XTAL_12M
 125   1                      TH0=0x9E;       //赋初值
 126   1                      TL0=0x56;  
 127   1      //        #else     
 128   1      //                TH0=0x4C;       //赋初值
 129   1      //                TL0=0x00;
 130   1      //        #endif
 131   1              TR0=1;
 132   1              time+=1;
 133   1              if(dir!=0)  // 减方向
 134   1              {
 135   2                      if (time>=40)
 136   2                      {
 137   3                              time=0;
 138   3                              count-=1;        //1秒时间到
 139   3                              if(count<0)
 140   3                                      count=9;
 141   3                      }
 142   2              }
 143   1              else   //加方向
 144   1              {
 145   2                      if(time>=20)
 146   2                      {
 147   3                              time=0;
 148   3                              count+=1;       //0.5秒时间到
 149   3                              if(count>=10)
 150   3                                      count=0;
 151   3                      }
 152   2              }
 153   1      }
 154          
 155          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    368    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
