C51 COMPILER V9.56.0.0   BSP_KEY                                                           01/22/2018 20:11:10 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE BSP_KEY
OBJECT MODULE PLACED IN ..\Output\bsp_key.obj
COMPILER INVOKED BY: D:\Program Files\AT89C51\C51\BIN\C51.EXE ..\User\bsp_key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User)
                    - DEBUG OBJECTEXTEND PRINT(..\Listing\bsp_key.lst) TABS(8) OBJECT(..\Output\bsp_key.obj)

line level    source

   1          #include <reg52.h>
   2          #include "bsp_key.h" 
   3          #include "bsp_delay.h" 
   4          
   5          sbit K1 = P2^1;
   6          sbit K2 = P2^2;
   7          sbit K3 = P2^3;
   8          sbit K4 = P2^4;
   9          sbit MA = P2^0;
  10          sbit MB = P2^7;
  11          
  12          u8 flag=0,flag_s=0; //flagæ˜¯æ­£åè½¬çš„æ ‡å¿—ä½ 0 ä»£è¡¨é€†æ—¶é’ˆ 1 ä»£è¡¨é¡ºæ—¶é’ˆ
  13                              //flag_sæ˜¯å¯åœæ ‡å¿—ä½ï¼ˆstar   stopï¼‰0 ä»£è¡¨ star 1 ä»£è¡¨ stop
  14          
  15          extern u8 ge,shi,location,duty_A,duty_B;  // å¤–éƒ¨å˜é‡çš„å£°æ˜
  16          
  17          /**
  18           * @brief æŒ‰é”®çš„æ‰«æ
  19           * @retval null
  20           */ 
  21          
  22          void key_scan()
  23          {
  24   1              u8 ge_t,shi_t; //å±€éƒ¨å˜é‡ç”¨äºå­˜å‚¨æ•°ç ç®¡çš„å€¼
  25   1              if(0 == K1)
  26   1              {
  27   2                      // æŒ‰é”®æ¶ˆæŠ–
  28   2                      delay(5);
  29   2                      if(0 == K1);
  30   2                      {
  31   3                              switch(flag_s)
  32   3                              {
  33   4                                      case(0):
  34   4                                        ET0=0;        //å…³å®šæ—¶å™¨ å®šæ—¶å™¨ä¸€å…³å°±æ²¡æœ‰è°å¯ä»¥æ”¹å˜duty
             -_B
  35   4                                        duty_A=0;     //ä¸¤ç›¸æ²¡æœ‰ç”µåŠ¿å·®ç”µæœºä¸ä¼šè½¬åŠ¨
  36   4                                        duty_B=0;
  37   4                                        
  38   4                                        ge_t=ge;      //ä¸´æ—¶å­˜å‚¨æ•°ç ç®¡çš„å€¼
  39   4                                        shi_t=shi;
  40   4                                        
  41   4                                        ge=0;         //ç”µæœºä¸è½¬å ç©ºæ¯”ä¸º0
  42   4                                        shi=0;
  43   4                                        flag_s=1;
  44   4                                      break;
  45   4                                      case(1):
  46   4                                        ET0=1;        //å¼€å®šæ—¶å™¨
  47   4                                        ge=ge_t;      //æ¢å¤æ•°ç ç®¡çš„æ˜¾ç¤º
  48   4                                        shi=shi_t;
  49   4                                        if(flag==1)   //å¦‚æœæ˜¯é¡ºæ—¶é’ˆçš„è¯ duty_A ç½® 1 
  50   4                                        {
  51   5                                                duty_A=1;
  52   5                                        }
  53   4      //                                 else        //è¿™æ®µä»£ç å¯ä»¥ä¸è¦æ”¾åœ¨è¿™é‡Œä¸ºäº†æ›´å¥½ç†è§£
C51 COMPILER V9.56.0.0   BSP_KEY                                                           01/22/2018 20:11:10 PAGE 2   

  54   4      //                                  {
  55   4      //                                          duty_A=0;
  56   4      //                                  }
  57   4                                        flag_s=0;
  58   4                                      break;
  59   4                                      
  60   4                              }
  61   3                              
  62   3                      }
  63   2                      
  64   2                      // æ¾æ‰‹æ£€æµ‹
  65   2                      while(0 == K1);
  66   2              }
  67   1              
  68   1              if(0 == K2)
  69   1              {
  70   2                      // æŒ‰é”®æ¶ˆæŠ–
  71   2                      delay(5);
  72   2                      if(0 == K2);
  73   2                      {
  74   3                              if(0==flag_s) //åªæœ‰åœ¨è½¬åŠ¨çš„çŠ¶æ€ä¸‹æ‰èƒ½æ”¹å˜è½¬åŠ¨çš„æ–¹å‘
  75   3                              {
  76   4                                      switch(flag)
  77   4                                      {
  78   5                                              case(0):                  //å¦‚æœç°åœ¨æ˜¯é€†æ—¶é’ˆåˆ™æ”¹å˜æˆé¡
             -ºæ—¶é’ˆ duty_A ç½® 1
  79   5                                                duty_A=1;               //æ”¹å˜å‰ PWM ç¤ºæ„å›¾ï¼ˆä»¥å ç©ºæ¯”
             - 80% ä¸ºä¾‹ï¼‰
  80   5                                                location=100-location;  //__________________Aç›¸
  81   5                                                flag=1;                 //--------------____Bç›¸
  82   5                                              break;                    //location=100-location  è¿™å¥ä»£ç å
             -å ç©ºæ¯”å˜æˆ 20%
  83   5                                              case(1):                  //------------------Aç›¸
  84   5                                                duty_A=0;               //----______________Bç›¸
  85   5                                                location=100-location;  //å ç©ºæ¯”è™½ç„¶å˜æˆ 20% ä½†ç”µåŠ¿å·®
             -å­˜åœ¨çš„æ—¶é—´ä¾ç„¶ä¸º 80%
  86   5                                                flag=0;                 //è½¬é€Ÿä¸å˜ï¼Œæ–¹å‘å´åäº†
  87   5                                              break;                    
  88   5                                      }
  89   4                              }
  90   3                      }
  91   2                      // æ¾æ‰‹æ£€æµ‹w
  92   2                      while(0 == K2);
  93   2              }
  94   1              
  95   1              if(0 == K3)
  96   1              {
  97   2                      // æŒ‰é”®æ¶ˆæŠ–
  98   2                      delay(5);
  99   2                      if(0 == K3);
 100   2                      {
 101   3                              if(flag_s==0)  //åªæœ‰åœ¨è½¬åŠ¨çš„çŠ¶æ€ä¸‹æ‰èƒ½æ”¹å˜å ç©ºæ¯”çš„å¤§å°
 102   3                              {
 103   4                                      if((shi*10+ge)<97)  //æ•°ç ç®¡çš„è¿›ä½
 104   4                                      {
 105   5                                              ge+=3;
 106   5                                              if(ge>=10)
 107   5                                              {
 108   6                                                      ge-=10;
 109   6                                                      shi+=1;
 110   6                                              }
 111   5                                      }
C51 COMPILER V9.56.0.0   BSP_KEY                                                           01/22/2018 20:11:10 PAGE 3   

 112   4                                      if((flag==0)&&location<97)     //é€†æ—¶é’ˆçŠ¶æ€ä¸‹å ç©ºæ¯”åŠ  3 
 113   4                                      {                              //__________________Aç›¸
 114   5                                              location+=3;           //--------------____Bç›¸
 115   5                                      }
 116   4                                      else if ((flag!=0)&&location>3)//é¡ºæ—¶é’ˆçŠ¶æ€ä¸‹å ç©ºæ¯”å‡ 3
 117   4                                      {                              //------------------Aç›¸ 
 118   5                                              location-=3;           //----______________Bç›¸
 119   5                                      }                              //å ç©ºæ¯”è™½ç„¶å°äº†ä½†ç”µåŠ¿å·®å­˜åœ¨çš
             -„æ—¶é—´å´å˜é•¿äº†
 120   4                              }
 121   3                      }
 122   2                      
 123   2                      // æ¾æ‰‹æ£€æµ‹
 124   2                      while(0 == K3);
 125   2              }
 126   1              
 127   1              if(0 == K4)
 128   1              {
 129   2                      // æŒ‰é”®æ¶ˆæŠ–
 130   2                      delay(5);
 131   2                      if(0 == K4);
 132   2                      {
 133   3                              if(0==flag_s)
 134   3                              {
 135   4                                      if((shi*10+ge)>5)
 136   4                                      {
 137   5                                              if(ge>=5)
 138   5                                              {
 139   6                                                      ge-=5;
 140   6                                              }
 141   5                                              else
 142   5                                              {
 143   6                                                      ge+=10;
 144   6                                                      ge-=5;
 145   6                                                      shi-=1;
 146   6                                              }
 147   5                                              
 148   5                                      }
 149   4                                      
 150   4                                      if((flag==0)&&location>5)
 151   4                                      {
 152   5                                              location-=5;
 153   5                                      }
 154   4                                      else if((flag!=0)&&location<95)
 155   4                                      {
 156   5                                              location+=5;
 157   5                                      }
 158   4                              }
 159   3                      }
 160   2                      
 161   2                      // æ¾æ‰‹æ£€æµ‹
 162   2                      while(0 == K4);
 163   2              }
 164   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    303    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       2
C51 COMPILER V9.56.0.0   BSP_KEY                                                           01/22/2018 20:11:10 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
