C51 COMPILER V9.56.0.0   MAIN                                                              05/14/2018 08:32:08 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\Output\main.obj
COMPILER INVOKED BY: D:\Program Files\AT89C51\C51\BIN\C51.EXE ..\User\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User) DE
                    -BUG OBJECTEXTEND PRINT(..\Listing\main.lst) TABS(8) OBJECT(..\Output\main.obj)

line level    source

   1          #include "reg52.h"
   2          #include "main.h"
   3          #include "bsp_delay.h"
   4          #include "bsp_key.h"
   5          
   6          #define Segment P0
   7          #define Digital P1
   8          
   9          /* å®šä¹‰æ¨¡å‹å˜é‡ */
  10          u8 value[6] = {1, 1, 5, 9, 0, 0};                                               // è®°å½•æ•°ç ç®¡æ¯ä¸€ä½
             -å¯¹åº”å€¼çš„æ•°ç»„
  11          u8 alarm[4] = {1, 2, 0, 0};                                                     // è®°å½•é—¹é’Ÿçš„æ—¶é—´çš
             -„å˜é‡ï¼Œè¿™é‡Œåªæ”¯æŒä¸€ä¸ªé—¹é’Ÿ
  12          u8 location = 0;                                                                // è®°å½•å½“æœŸæ˜¯å“ªä¸€ä½
             -é—ªçƒ
  13          u8 state = STATE_RUNNING;                                                       // è®°å½•å½“å‰ç”µå­è¡¨çš
             -„çŠ¶æ€
  14          
  15          sbit beep = P3^7;
  16          
  17          /* æ•°ç ç®¡æ®µé€‰ç ã€ä½é€‰ç  */
  18          u8 SegCode[10] = {0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F};  // æ®µé€‰é«˜ç”µå¹³æœ‰æ•ˆ
  19          u8 DigCode[6] = {0xfe, 0xfd, 0xfb, 0xf7, 0xef, 0xdf};   // ä½é€‰ä½ç”µå¹³æœ‰æ•ˆ
  20          
  21          u8 InterruptCount = 0;
  22          
  23          int main()
  24          {
  25   1              u8 i, j;
  26   1              
  27   1              /* è¿™é‡Œè®¾ç½®çš„å€¼æ˜¯è¡¨ç¤ºï¼Œ10æ¬¡æ‰«æå…¨éƒ¨æ˜¾ç¤ºï¼Œ10æ¬¡æ‰«ælocationä½ä¸æ˜¾ç¤º */
  28   1              u8 dispalyCount = 10;
  29   1              
  30   1              IT0 = 1;
  31   1              TMOD = 0x01;
  32   1              TH0 = 0x0b;
  33   1              TL0 = 0xdc;
  34   1              IE = 0x83;
  35   1              TR0 = 1;
  36   1              
  37   1              beep = 0;
  38   1              
  39   1              while(1)
  40   1              {
  41   2                      if((state == STATE_RUNNING) || (state == STATE_SETTING))
  42   2                      {
  43   3                              
  44   3                              /* è¿™é‡Œæ‰«æçš„æ—¶å€™æ˜¯æ­£å¸¸æ˜¾ç¤º6ä½ */
  45   3                              for(j = dispalyCount; j > 0; j--)
  46   3                              {
  47   4                                      for(i = 0; i < 6; i++)
  48   4                                      {
  49   5                                              Digital = DigCode[i];
  50   5                                              
C51 COMPILER V9.56.0.0   MAIN                                                              05/14/2018 08:32:08 PAGE 2   

  51   5                                              /* è¿™æ˜¯æ˜¯åœ¨ç¬¬ä¸€ä½å’Œç¬¬ä¸‰ä½çš„ä½ç½®ä¸Šæ·»åŠ å°æ•°ç‚¹ */
  52   5                                              if(i == 1 || i == 3)
  53   5                                              {
  54   6                                                      /* é€šè¿‡æŒ‰ä½ä¸æ“ä½œï¼Œåœ¨ä¸æ”¹å˜ä½7ä½çš„å‰æä¸‹
             -ï¼Œå°†ä½7ç½®ä¸ºé«˜ç”µå¹³ */
  55   6                                                      Segment = SegCode[value[i]] | 0x80;
  56   6                                              }
  57   5                                              else
  58   5                                              {
  59   6                                                      Segment = SegCode[value[i]];
  60   6                                              }
  61   5                                              delay_ms(1);
  62   5                                      }
  63   4                              }
  64   3                              
  65   3                              if(state == STATE_SETTING)
  66   3                              {
  67   4                                      /* è¿™é‡Œæ‰«æçš„æ—¶å€™locationå¯¹åº”ä½ä¸æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºå…¶ä»–ä½ */
  68   4                                      for(j = dispalyCount; j > 0; j--)
  69   4                                      {
  70   5                                              for(i = 0; i < 6; i++)
  71   5                                              {
  72   6                                                      /* åˆ¤æ–­å½“æœŸæ‰«æçš„ä½æ˜¯ä¸æ˜¯locationå¯¹åº”ä½ */
  73   6                                                      if(location == i)
  74   6                                                      {
  75   7                                                              /* å¦‚æœæ˜¯çš„è¯ï¼Œä¸é€‰ä¸­ä»»ä½•ä½é€‰ï¼Œä¹Ÿå°
             -±æ˜¯å…¨ç­ */
  76   7                                                              Digital = 0xff;
  77   7                                                      }
  78   6                                                      else
  79   6                                                      {
  80   7                                                              /* å¯¹äºå…¶ä»–ä¸ºå°±æ­£å¸¸æ˜¾ç¤ºå°±å¥½ */
  81   7                                                              Digital = DigCode[i];
  82   7                                                      }
  83   6                                                      
  84   6                                                      /* è¿™é‡Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼ŒåŠ å°æ•°ç‚¹çš„æ“ä½œ */
  85   6                                                      if(i == 1 || i == 3)
  86   6                                                      {
  87   7                                                              Segment = SegCode[value[i]] | 0x80;
  88   7                                                      }
  89   6                                                      else
  90   6                                                      {
  91   7                                                              Segment = SegCode[value[i]];
  92   7                                                      }
  93   6                                                      delay_ms(1);
  94   6                                              }
  95   5                                      }
  96   4                              }
  97   3                      }
  98   2                      else if(state == STATE_ALARM)
  99   2                      {
 100   3                              /* è¿™é‡Œæ‰«æçš„æ—¶å€™æ˜¯æ­£å¸¸æ˜¾ç¤º4ä½ */
 101   3                              for(j = dispalyCount; j > 0; j--)
 102   3                              {
 103   4                                      for(i = 0; i < 4; i++)
 104   4                                      {
 105   5                                              Digital = DigCode[i];
 106   5                                              
 107   5                                              /* è¿™æ˜¯æ˜¯åœ¨ç¬¬ä¸€ä½æ·»åŠ å°æ•°ç‚¹ */
 108   5                                              if(i == 1)
 109   5                                              {
 110   6                                                      /* é€šè¿‡æŒ‰ä½ä¸æ“ä½œï¼Œåœ¨ä¸æ”¹å˜ä½7ä½çš„å‰æä¸‹
C51 COMPILER V9.56.0.0   MAIN                                                              05/14/2018 08:32:08 PAGE 3   

             -ï¼Œå°†ä½7ç½®ä¸ºé«˜ç”µå¹³ */
 111   6                                                      Segment = SegCode[alarm[i]] | 0x80;
 112   6                                              }
 113   5                                              else
 114   5                                              {
 115   6                                                      Segment = SegCode[alarm[i]];
 116   6                                              }
 117   5                                              delay_ms(1);
 118   5                                      }
 119   4                              }
 120   3                              
 121   3                              for(j = dispalyCount; j > 0; j--)
 122   3                              {
 123   4                                      for(i = 0; i < 4; i++)
 124   4                                      {
 125   5                                              /* åˆ¤æ–­å½“æœŸæ‰«æçš„ä½æ˜¯ä¸æ˜¯locationå¯¹åº”ä½ */
 126   5                                              if(location == i)
 127   5                                              {
 128   6                                                      /* å¦‚æœæ˜¯çš„è¯ï¼Œä¸é€‰ä¸­ä»»ä½•ä½é€‰ï¼Œä¹Ÿå°±æ˜¯å…¨ç
             -­ */
 129   6                                                      Digital = 0xff;
 130   6                                              }
 131   5                                              else
 132   5                                              {
 133   6                                                      /* å¯¹äºå…¶ä»–ä¸ºå°±æ­£å¸¸æ˜¾ç¤ºå°±å¥½ */
 134   6                                                      Digital = DigCode[i];
 135   6                                              }
 136   5                                              
 137   5                                              /* è¿™é‡Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼ŒåŠ å°æ•°ç‚¹çš„æ“ä½œ */
 138   5                                              if(i == 1)
 139   5                                              {
 140   6                                                      Segment = SegCode[alarm[i]] | 0x80;
 141   6                                              }
 142   5                                              else
 143   5                                              {
 144   6                                                      Segment = SegCode[alarm[i]];
 145   6                                              }
 146   5                                              delay_ms(1);
 147   5                                      }
 148   4                              }
 149   3                      }
 150   2              }
 151   1      }
 152          
 153          /**
 154           * @Descroption å¤–éƒ¨ä¸­æ–­0ä¸­æ–­æœåŠ¡å‡½æ•°
 155           */ 
 156          void INT0_Handler() interrupt 0
 157          {
 158   1              Key_Control(Key_Scan());
 159   1      }
 160          
 161          /**
 162           * @Descroption å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•°
 163           */
 164          void TIM0_Handler() interrupt 1
 165          {
 166   1              /* æ‰‹åŠ¨çš„è£…è½½åˆå€¼ */
 167   1              TH0 = 0x0b;
 168   1              TL0 = 0xdc;
 169   1              
 170   1              InterruptCount++;
C51 COMPILER V9.56.0.0   MAIN                                                              05/14/2018 08:32:08 PAGE 4   

 171   1              
 172   1              if(InterruptCount >= 16)
 173   1              {
 174   2                      InterruptCount = 0;
 175   2                      Run();
 176   2              }        
 177   1      }
 178          
 179          /**
 180           * @Descroption ç”µå­è¡¨æ­£å¸¸è¿è¡Œå‡½æ•°ï¼Œæ¯1såŠ ä¸€ï¼Œå¹¶å®Œæˆçš„å¯¹åº”çš„è¿›ä½
 181           */ 
 182          void Run(void)
 183          {     
 184   1              if(value[5] < 9)
 185   1              {
 186   2                      value[5]++;
 187   2              }
 188   1              else
 189   1              {
 190   2                      value[5] = 0;
 191   2                      
 192   2                      if(value[4] < 5)
 193   2                      {
 194   3                              value[4]++;
 195   3                      }
 196   2                      else
 197   2                      {
 198   3                              value[4] = 0;
 199   3                              
 200   3                              if(value[3] < 9)
 201   3                              {
 202   4                                      value[3]++;
 203   4                              }
 204   3                              else
 205   3                              {
 206   4                                      value[3] = 0;
 207   4                                      
 208   4                                      if(value[2] < 5)
 209   4                                      {
 210   5                                              value[2]++;
 211   5                                      }
 212   4                                      else
 213   4                                      {
 214   5                                              value[2] = 0;
 215   5                                              
 216   5                                              /* å¦‚æœæ—¶çš„åä½ä¸º0æˆ–è€…1çš„è¯ï¼Œæ—¶çš„ä¸ªä½å…¶å®æ˜¯å¯ä
             -»¥æ˜¾ç¤º0-9çš„ */
 217   5                                              /* å¦‚æœæ—¶çš„åä½ä¸º2çš„è¯ï¼Œé‚£æ—¶çš„ä¸ªä½å°±åªèƒ½æ˜¾ç¤º0-
             -3äº† */
 218   5                                              if(((value[0] < 2) && (value[1] < 9)) || ((value[0] == 2) && (valu
             -e[1] < 3)))
 219   5                                              {
 220   6                                                      value[1]++;
 221   6                                              }
 222   5                                              else 
 223   5                                              {
 224   6                                                      value[1] = 0;
 225   6                                                      
 226   6                                                      if(value[0] < 2)
 227   6                                                      {
 228   7                                                              value[0]++;
 229   7                                                      }
C51 COMPILER V9.56.0.0   MAIN                                                              05/14/2018 08:32:08 PAGE 5   

 230   6                                                      else
 231   6                                                      {
 232   7                                                              value[0] = 0;
 233   7                                                      }
 234   6                                              }
 235   5                                      }
 236   4                              }
 237   3                      }
 238   2              }
 239   1              
 240   1              if((value[0] == alarm[0]) && (value[1] == alarm[1]) && (value[2] == alarm[2]) && (value[3] == alar
             -m[3]))
 241   1              {
 242   2                      beep = 1;
 243   2              }
 244   1              else
 245   1              {
 246   2                      beep = 0;
 247   2              }
 248   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    658    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     29       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
